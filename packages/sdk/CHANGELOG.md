# Changelog

### Unreleased

- Merge `joinSplitTx.encodedAssetAddr` and `joinSplitTx.encodedAssetId` into one `joinSplitTx.encodedAsset`
- Add utility function to estimate `executionGasLimit` and `maxNumRefund`
- Change note commitment to use encoded `asset` and `ID`
- Add and `encode` and `decode` methods to `NoteTrait`
- Change `NoteInput` to `EncodedNote`
- Refactor DB interfaces
  - separate underlying `KVStore` from "DB"s by defining `KVStore` abstract class
  - implement `KVStore` with a new class `InMemoryKVStore` using a B+ Tree lib
  - split `NocturneDB` into `NotesDB` and `MerkleDB`
  - add tests
  - integrate new DB interfaces into `LocalMerkleProver`, `LocalNotesManager`, and `NocturneContext`
- Add util method for parsing events from tx receipt and break utils into `bits.ts` and `ethers.ts`
- Bug fix, `packToSolidityProof` casts numbers to bigints
- Update `gatherMinimumNotes` logic to actually gather minimum number of notes
- Add interfaces for generating and receiving confidential payments
- Remove `toJSON` and all `fromJSON` methods in favor of custom `bigint-json-serialization`
- Add query function for `SubtreeUpdate` events
- Pull out note / tree insertion fetching logic into `indexing` module
- Add `indexing` module for code that fetches data from chain
- Add interfaces for subtree update prover
- Remove unnessary normalization of circuit values
- Add context methods for ensuring min asset balance and reading all balances
- Proving no longer takes files as function args (moved to local-prover class instantiation)
- Migrate to joinsplit circuit
  - Nocturne context refractoe: Presign -> PreProof -> Proven
  - Note encryption and decryption
  - New note fetching logic
- Rename all "flax" instances to "nocturne"
- Change package version to `-alpha`
- Break out SDK methods into sub methods and expose a method for gathering spend tx inputs for site/snap to use
- Replace `LMDB` with `ObjectDB`, which fits structure of MM snap schema
- Take out all fs and proving related capabilities from SDK and replace with blank interfaces (turn SDK into shim)
- Rename `PostProof` to `Proven` among data types
- add `update` method to `BinaryPoseidonTree`
- use `bigint-conversion` for bigint packing stuff
- Update merkle prover indexing logic to work with off-chain updates
- add script to generate input signals for `subtreeupdate` circuit
- Fix indexing bug when only querying a single block
- Add scripts to generate test cases for joinsplit circuit
- Add `sdk` directory to include `db`, `merkleProver`, `notesManager` and wrap up that functionality in `NocturneContext`
- Add `NocturneLMDB` as local SDK `NocturneDB`
- Add `LocalNotesManager` as local SDK `NotesManager`
- Add `LocalMerkleProver` as local SDK `MerkleProver`
- Have all packages follow `index.ts` --> `export *` structure
- Rename spend transaction `value` to `valueToSpend`
- Add `NocturneContext` object and add functionality for converting an asset request and desired operation to a `PostProofOperation` containing potentially several spend txs
- Update `generateSpend2TestCase` script to write to `/fixtures`
- Update `NocturneSigner` to derive `vk` from `sk` and use simplified 2 field `NocturneAddress`
- Move spend2 circuit prove/verify methods into sdk
- Add babyjub classes and poseidon tree
