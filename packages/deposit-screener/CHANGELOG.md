# Changelog

### Unreleased

- close other workers/iters/async "threads" when one of them fails
- add window recovery logic to fulfiller
- add fulfiller to `docker-compose.yml`
- add fulfiller to CLI
- add fulfillment queue logic in `DepositScreenerFulfiller`
  - have separate fulfillment queue for each asset
  - make a bullmq `Worker` for each queue that enforces rate limit
  - move tx submission into fulfiller
- add `DepositRateLimiter` that keeps track of a moving window of recent deposits and can check if rate limit would be exceeded.
- update `.env.example`
- go back to only one docker-compose file
- add `--stdout-log-level` option to CLI
- processor switches on token type and calls `completeErc20Deposit`
- add `--throttle-ms` arg to CLI
- bump max chunk size up to 100K blocks
- add optional argument `queryThrottleMs` to `DepositScreenerProcessor.start` and use it when instantiating iterator
- add support for `throttleMs` option to sync adapter
- pull `startBlock` from `config.contracts` and pass it to `startBlock` in processor cli
- add `startBlock` parameter to `DepositScreenerProcessor`
- subgraph fetch functions query via `idx_gte` and `idx_lt` instead of `id_gte` and `id_lt`
- create separate `docker-compose.local.yml` and `docker-compose.dev.yml` where `dev` version pulls from docker hub
- tag docker image with nocturnelabs org name
- add `yarn build:docker-compose` which builds docker compose
- `yarn build:docker` now builds CLI container, not docker compose.
- CLI uses config package to get contract addresses
- add `--log-dir` option to CLI with defaults
- add winston logging
- add 5 retries with exponential backoff to deposit screener
- fix `SubgraphScreenerSyncAdapter` querying entire history instead of only specified range
- Update eip712 signing to not include `chainId` in `DepositRequest` (already included in eip712 domain)
- make processor stoppable by renaming `run` to `start` and returning a "close" function
- print errors in console
- Fix bug where `depositRequest.depositAddr` was being incorrectly copied over from subgraph
- Add Dockerfile and docker-compose.yml
- Delete `enqueue.ts` and move logic into `processor.ts`
- Move env var parsing to CLI
- Add stubs for non-server screener functionality
  - Processor (fetches new deposit events, checks, enqueues)
  - Submitter (takes new deposit requests of queue and signs/submits)
  - DB implementation for storing rate limits and statuses
  - Sync submodule that currently only has subgraph impl
  - CLI submodule to start components
  - Screening submodule (mocked)
  - Delay sumodule (mocked)
- Break out signing and hashing into `typeData` submodule
- Add deposit request hash to contract fixture
- Add subgraph query functionality + test script to ensure it works
- Add EIP712 signing logic + script for generating fixture
